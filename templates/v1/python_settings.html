{% extends "v1/base.html" %}

{% block title %}Python Settings{% endblock %}

{% block extra_css %}
<style>
    .form-label { font-weight: 500; }
    .code-input { font-family: 'Monaco', 'Courier New', monospace; }
</style>
{% endblock %}

{% block content %}

        <div class="row mb-4">
            <div class="col">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('settings') }}">Settings</a></li>
                        <li class="breadcrumb-item active">Python Interpreter</li>
                    </ol>
                </nav>
                <h1><i class="bi bi-code-slash me-2"></i>Python Interpreter Settings</h1>
                <p class="text-muted">Configure which Python interpreter and environment to use for script execution</p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Configuration</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="mb-3">
                                <label for="python_executable" class="form-label">
                                    <i class="bi bi-file-earmark-code me-1"></i>Python Executable
                                </label>
                                
                                {% if available_interpreters %}
                                <div class="mb-2">
                                    <label for="interpreter_select" class="form-label small">
                                        <i class="bi bi-search me-1"></i>Detected Interpreters
                                    </label>
                                    <select class="form-select" id="interpreter_select" onchange="selectInterpreter()">
                                        <option value="">Choose a detected interpreter...</option>
                                        {% for interp in available_interpreters %}
                                        <option value="{{ interp.path }}" 
                                                {% if interp.path == python_executable %}selected{% endif %}>
                                            {{ interp.display }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                {% endif %}
                                
                                <input type="text" class="form-control code-input" id="python_executable" 
                                       name="python_executable" value="{{ python_executable }}"
                                       placeholder="python3 or /usr/bin/python3">
                                <div class="form-text">
                                    {% if available_interpreters %}
                                    Choose from detected interpreters above or enter a custom path below.
                                    {% else %}
                                    Path to Python executable. Use 'python3' for system default or full path like '/usr/bin/python3'
                                    {% endif %}
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="python_env" class="form-label">
                                    <i class="bi bi-folder me-1"></i>Virtual Environment (Optional)
                                </label>
                                <input type="text" class="form-control code-input" id="python_env" 
                                       name="python_env" value="{{ python_env }}"
                                       placeholder="/path/to/venv or leave empty">
                                <div class="form-text">
                                    Path to virtual environment directory. Leave empty to use system Python.
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-lg me-2"></i>Save Settings
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="testConfiguration()">
                                    <i class="bi bi-play-circle me-2"></i>Test Configuration
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Examples</h6>
                    </div>
                    <div class="card-body">
                        <h6>System Python:</h6>
                        <code>python3</code>
                        <hr>
                        <h6>Specific Version:</h6>
                        <code>/usr/bin/python3.9</code>
                        <hr>
                        <h6>Anaconda:</h6>
                        <code>/opt/anaconda3/bin/python</code>
                        <hr>
                        <h6>Virtual Environment:</h6>
                        <code>/home/user/myenv</code>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Test Result</h6>
                    </div>
                    <div class="card-body">
                        <div id="test-result">Click "Test Configuration" to verify settings</div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block extra_js %}
<script>
    function selectInterpreter() {
        const select = document.getElementById('interpreter_select');
        const input = document.getElementById('python_executable');
        if (select.value) {
            input.value = select.value;
        }
    }
    
    function testConfiguration() {
        const pythonExec = document.getElementById('python_executable').value;
        const pythonEnv = document.getElementById('python_env').value;
        const resultDiv = document.getElementById('test-result');
        
        resultDiv.innerHTML = '<i class="bi bi-clock-history me-1"></i>Testing configuration...';
        
        fetch('/api/terminal/execute', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ command: 'python --version' })
        })
        .then(response => response.json())
        .then(data => {
            if (data.returncode === 0) {
                resultDiv.innerHTML = `
                    <div class="text-success">
                        <i class="bi bi-check-circle me-1"></i>Configuration OK<br>
                        <small>${data.stdout.trim()}</small>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="text-danger">
                        <i class="bi bi-x-circle me-1"></i>Configuration Error<br>
                        <small>${data.stderr || data.error}</small>
                    </div>
                `;
            }
        })
        .catch(error => {
            resultDiv.innerHTML = `
                <div class="text-danger">
                    <i class="bi bi-x-circle me-1"></i>Test Failed<br>
                    <small>${error.message}</small>
                </div>
            `;
        });
    }
</script>
{% endblock %}